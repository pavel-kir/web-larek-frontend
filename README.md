# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

Заказ

```
interface IOrder {
  payment: string;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Данные из модального окна доставки товара

```
type TOrderDelivery = Pick<IOrder, 'payment' | 'address'>;
```

Данные из модального окна контактов

```
type TOrderContact = Pick<IOrder, 'email' | 'phone'>;
```

Интерфейс для модели данных списка товаров

```
interface IProductsData {
  products: IProduct[];
  getProduct(id: string): IProduct | undefined;
}
```

Интерфейс для модели данных заказа

```
interface IOrderData {
  addProduct(item: IProduct): void;
  deleteProduct(id: string): void;
  getProducts(): IProduct[];
  getProduct(id: string): IProduct | undefined;
  setDelivery(delivery: TOrderDelivery): void;
  setContact(contact: TOrderContact): void;
  getTotal(): number;
  getCount(): number;
  getOrder(): IOrder;
  clearOrder(): void;
}
```

Данные списка товаров, получаемые с сервера

```
type TProductAnswer = {total: number, items: IProduct[]};
```

Ответ сервера после отправки заказа

```
export type TOrderAnswer = {id: string, total: number};
```

Интерфейс для работы с серером

```
interface IAppApi {
  getProductList: () => Promise<IProduct[]>;
  postOrder: (order: IOrder) => Promise<TOrderAnswer>;
}
```

Интерфейс для заполнения модального окна

```
interface IModalData {
  content: HTMLElement;
}
```

Интерфейс для заполнения главной страницы

```
interface IPage {
  counter: number;
  catalog: HTMLElement[];
  locked(value: boolean): void;
}
```

Интерфейс для заполнения корзины

```
interface IBasket {
  list: HTMLElement[];
  price: number;
}
```

Интерфейс для окна успешного оформления

```
interface ISuccess {
  total: number;
}
```

Интерфейс объекта, к котором передаётся id товара

```
interface IId {
  id: string;
}
```

## Архитектура приложения

Приложение разделено на `3 слоя` и использует парадигму `MVP`
- Слой `Model` отвечает за данные и работу с ними
- Слой `View` отвечает за отображение на странице
- Слой `Presenter` отвечает за связь Model с View

Приложение использует событийно-ориентированный подход. Это означает что объекты представления напрямую не взаимодействуют ни между собой ни с объектами данных, всё происходит посредством событий.\
Пример взаимодействия:
- Пользователь просматривает каталог товаров и нажимает на один из них, чтобы просмотреть.
- При нажатии, генерируется событие  `card:select` и передаётя id товара, который нужно открыть в попапе.
- Срабатывает обработчик события `card:select`, который по id получает объект с товаром из модели и затем рендерит попап с полученными данными.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов.\
В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.\
Методы:  
- `on` ,  `off` ,  `emit` — для подписки на событие, отписки от события и уведомления подписчиков о наступлении события соответственно.  
- `onAll` и  `offAll` — для подписки на все события и сброса всех подписчиков.  
- `trigger` — генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса  EventEmitter.

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и работу со списком товаров.\
Конструктор класса принимает инстант брокера событий.\
Поля класса
- _products: IProduct[] - массив объектов карточек товара
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Методы класса
- set products(products: IProduct[]) - сеттер устанавливает массив карточек товаров.
- get products(): IProduct[] - геттер возвращает массив карточек товаров.
- getCard(id: string): IProduct | undefined - возвращает карточку товара по её id, если такая есть.

#### Класс OrderData
Класс отвечает за хранение и работу с товарами, которые были добавлены в корзину и данными пользователя для заказа\
Конструктор класса принимает инстант брокера событий.\
Поля класса
- payment: string - вид оплаты нал/безнал
- email: string - электронная почта
- phone: string - номер телефона
- address: string - адрес
- items: IProduct[] - массив товаров в корзине
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных

Методы класса
- addProduct(item: IProduct): void - добавляет товар в заказ
- deleteProduct(id: string): void - удаляет товар из заказа
- getProducts(): IProduct[] - возвращает массив товаров в заказе
- getProduct(id: string): IProduct | undefined - ищет товар в заказе по id и возвращает его если такой имееется 
- setDelivery(delivery: TOrderDelivery): void - добавляет способ оплаты и адрес
- setContact(contact: TOrderContact): void - добавляет электронную почту и телефон
- getTotal(): number - возвращает общую стоимость товаров в заказе
- getCount(): number - возвращает количество товаров в заказе
- getOrder(): IOrder - возвращает объект заказа, в виде необходимом для отправки на сервер
- clearOrder(): void - очищает заказ

### Классы представления

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Page
Управляет отображением всей страницы. Управляет значком корзины, предоставляет контейнер для списка товаров,
блокирует прокрутку страницы, когда открыто модальное окно. В родительский метод render передаём массив элементов карточек товара.
- constructor(container: HTMLElement, events: IEvents) - конструктор принимает селектор, саму страницу и экземпляр класса `EventEmitter`.

Поля класса
- _counter: HTMLSpanElement - количество товаров в корзине
- _catalog: HTMLElement - контейнер, для списка товаров
- basket: HTMLButtonElement - значок корзины
- events: IEvents - брокер событий

Методы класса
- set counter(value: number) - сеттер устанавливает количество товаров в корзине
- set catalog(items: HTMLElement[]) - сеттер добавляет список товаров на страницу
- locked(value: boolean) - блокирует или разблокирует прокрутку страницы

#### Класс Modal
Реализует модальное окно. Отвечает только за само окно, единое для всего приложения. В него передаются разные данные, в зависимости от того что необходимо отобразить. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(container: HTMLElement, events: IEvents) - конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- _content: HTMLElement - элемент, который будет отображаться внутри модального окна
- closeButton: HTMLButtonElement - кнопка закрытия модального окна
- events: IEvents - брокер событий

Методы класса
- set content(value: HTMLElement) - сеттер устанавливает отображаемый элемент внутри окна
- open() - открывает окно
- close() - закрывает окно
- render(data: IModalData): HTMLElement - получает элемент, который будет отображён внутри модального окна.Метод расширяет родительский, так как необходимо ещё открывать модальное окно.

#### Класс Card
Предназначен для отбражения карточки товара. В приложение используется единый класс карточки для отображения в списке товаров, открытом товаре и списке товаров в корзине. Вид карточки меняется в зависимости от передаваемого в неё темплейта. В классе представлены все поля, которые есть в трёх темплейтах. Когда в переданном темплейте нет какого-то элемента, значение поля, отвечающего за него будет просто null. В родительский метод render передаём данные карточки товара.
- constructor( container: HTMLTemplateElement, events: IEvents) - конструктор принимает темплейт необходимой карточки и экземпляр класса `EventEmitter`

Поля класса
- cardId: string - id товара
- cardDescription: HTMLParagraphElement - подробное описание товара 
- cardImage: HTMLImageElement - картинка товара
- cardTitle: HTMLHeadingElement - название товара
- cardCategory: HTMLSpanElement - категория товара
- cardPrice: HTMLSpanElement - цена товара
- cardIndex: HTMLSpanElement - индекс товара в корзине
- addButton: HTMLButtonElement - кнопка добавления товара в корзину
- removeButton: HTMLButtonElement - кнопка удаления товара из корзины
- events: IEvents - брокер событий

Методы класса
- set id(id: string) - сеттер устанавливает карточке id соответсвующего товара
- set description (description: string) - сеттер устанавливает описание товара
- set image (image: string) - сеттер устанавливает изображение товара
- set title (title: string) - сеттер устанавливает название товара
- set category (category: string) - сеттер устанавливает категорию товара
- set price (price: number | null) - сеттер устанавливает цену товара
- lockedButton (value: boolean) - делает кнопку купить доступной или недоступной.
- setIndex (index: number) - устанавливает номер товара в корзине
- getId() - возвращает id карточки

#### Класс Basket
Предназначен для отображения корзины. Класс представляет из себя пустую корзину, в которую добавляется список товаров в корзине. Каждый товар это отдельный экземпляр класса Card. В родительский метод render передаём массив элементов карточек товара.
- constructor(container: HTMLTemplateElement, events: IEvents) - конструктор принимает темплейт корзины и экземпляр класса `EventEmitter`

Поля класса
- container: HTMLTemplateElement - сама корзина
- _list: HTMLElement - список товаров в корзине
- _price: HTMLSpanElement - сумма заказа
- button: HTMLButtonElement - кнопка Оформить
- events: IEvents - брокер событий

Методы класса
- set price (price: number) - сеттер устанавливает стоимость заказа
- set list (items: HTMLElement[]) - сеттер добавляет список тваров

#### Класс Order
Отвечает за отбражение данных в окне оформления заказа, где пользователь выбирает способ оплаты и вводит адрес доставки. Родительский метод render не устанавливает никаких значений, а только возвращает элемент для его отображения в модальном окне.
- constructor(container: HTMLTemplateElement, events: IEvents) - конструктор принимает темплейт необходимого окна и экземпляр класса `EventEmitter`

Поля класса
- container: HTMLTemplateElement - окно оформления заказа
- cardButton: HTMLButtonElement - кнопка, отвечающая за оплату картой
- cashButton: HTMLButtonElement - кнопка, отвечающая за оплату наличными
- inputAddress: HTMLInputElement - поле адреса доставки
- submitButton: HTMLButtonElement - кнопка перехода к следующему шагу
- fotmError: HTMLSpanElement - элемент отвечающий за вывод сообщения об ошибке
- payment: string - выбранный способ оплаты
- address: string - адрес доставки
- events: IEvents - брокер событий

Методы класса
- checkButton() - проверяет условия и делает кнопку перехода к следующему шагу активной или неактивной
- setPayment(type: string) - устанавливает выбранный тип оплаты

#### Класс Contacts
Отвечает за отбражение данных в окне оформления заказа, где пользователь вводит электронную почту и телефон.
Родительский метод render не устанавливает никаких значений, а только возвращает элемент для его отображения в модальном окне.
- constructor(container: HTMLTemplateElement, events: IEvents) - конструктор принимает темплейт необходимого окна и экземпляр класса `EventEmitter`

Поля класса
- container: HTMLTemplateElement - окно оформления заказа
- inputEmail: HTMLInputElement - поле электронной почты
- inputPhone: HTMLInputElement - поле телефона
- submitButton: HTMLButtonElement - кнопка отправки заказа
- fotmError: HTMLSpanElement - элемент отвечающий за вывод сообщения об ошибке
- email: string - электронная почта
- phone: string - телефон
- events: IEvents - брокер событий

Методы класса
- checkButton() - проверяет условия и делает кнопку отправки заказа активной или неактивной

#### Класс Success
Окно успешного оформления заказа.  В родительский метод render передаём стоимость оформленного заказа, которую получаем в ответе от сервера.
- constructor(container: HTMLTemplateElement, events: IEvents) - конструктор принимает темплейт необходимого окна и экземпляр класса `EventEmitter`

Поля класса
- container: HTMLTemplateElement - окно успешного оформления заказа
- closeButton: HTMLButtonElement - кнопка закрытия окна
- checkForm: HTMLParagraphElement - элемент отобажающий стоимость заказа
- events: IEvents - брокер событий

Методы класса
- set total(total: number) - устанавливает стоимость заказа

### Слой коммуникации

#### Класс AppApi
Расширяет класс Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
constructor(baseUrl: string, cdn: string) - конструктор принимает основной адрес сервера и адрес хранения изображений.

Поля класса
- cdn: string - адрес сервера изображений

Методы класса
- getProductList() - получает с сервера список товаров
- postOrder(order: IOrder) - отправляет на сервер заказ 

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `order:changed` - изменение списка товаров в заказе
- `products:changed` - изменение массива товаров

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `card:select` - выбор товара для открытия
- `bids:render` - создает или обновляет окно с корзиной
- `bids:add` - добавление товара в корзину
- `bids:remove` - удаление товара из корзины
- `order:render` - открытие окна добавления способа оплаты и адреса
- `contacts:render` - открытие окна добавления контактов
- `success:render` - открытие окна успешного оформления заказа
- `success:close` - закрытие окна успешного оформления заказа